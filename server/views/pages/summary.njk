{% extends "partials/case-view.njk" %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "../components/instructions/macro.njk" import instructions %}
{% set pageTitle = applicationName + " - Summary" %}
{% set offenceData = data.offences %}
{%- set offences = [] -%}
{%- for offence in offenceData  if offenceData %}
    {{ offences.push(offence) }}
{% endfor -%}



{% block caseContent %}

    <h2 class="govuk-heading-l">Summary</h2>
    <section class="app-summary-card govuk-!-margin-bottom-6 app-summary-card--large-title" id ="personal-details">
        <header class="app-summary-card__header">
            <h2 class="app-summary-card__title">Personal details</h2>
        </header>
        <div class="app-summary-card__body">
            {{ govukSummaryList({
                rows: [
                    {
                        key: {
                        text: "Name"
                    },
                        value: {
                        text: data.name
                    }
                    },
                    {
                        key: {
                        text: "Gender"
                    },
                        value: {
                        text: data.gender
                    }
                    },
                    {
                        key: {
                        text: "Date of birth"
                    },
                        value: {
                        text: data.dateOfBirth  | dateFormat + ' (' + data.age + ' years old)'
                    }
                    }
                ]
            })}}
        </div>
    </section>

    <section class="app-summary-card govuk-!-margin-bottom-6 app-summary-card--large-title" id ="sentence">
        <header class="app-summary-card__header">
            <h2 class="app-summary-card__title">Sentence</h2>
        </header>
        <div class="app-summary-card__body">
            <dl class="govuk-summary-list">
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">Offence</dt>
                        <dd class="govuk-summary-list__value">
                            {% if offences | length == 1 %}
                                {%- for offence in offences  if offences %}
                                <h3 class="govuk-heading-s govuk-!-margin-top-0 govuk-!-margin-bottom-1">
                                    {{  offence.mainCategory}}
                                </h3>
                                    <p class="govuk-body-s maw-secondary-text-col"><strong>{{ offence.subCategory }}</strong></p>
                                {% endfor -%}
                            {% else %}
                                <ol class="govuk-list govuk-list--number">
                                    {%- for offence in offences  if offences %}
                                    <li>{{ offence.mainCategory }}</li>
                                        <p class="govuk-body-s maw-secondary-text-col"><strong>{{ offence.subCategory }}</strong></p>
                                    {% endfor -%}
                                </ol>
                            {% endif %}
                        </dd>
                </div>

                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">Order</dt>
                    <dd class="govuk-summary-list__value">
                        <h3 class="govuk-heading-s govuk-!-margin-top-0 govuk-!-margin-bottom-1">
                            {{ data.sentenceDescription }} ({{ data.sentenceDate | dateDifference(data.expectedSentenceEndDate)}})
                        </h3>
                        <ul class="govuk-list govuk-list--bullet">
                            <li>Start date: {{ data.sentenceDate | dateFormat }}</li>
                            <li>End date: {{ data.expectedSentenceEndDate | dateFormat }}</li>
                        </ul>
                    </dd>
                </div>

                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">Requirements</dt>
                    <dd class="govuk-summary-list__value">
                        <ul class="govuk-list govuk-list--bullet">
                            {%- for requirement in data.requirements  if data.requirements %}
                            <li>{{ requirement.mainCategory }}: {{ requirement.subCategory }} {{ requirement.length }} {{ requirement.lengthUnit }}</li>
                            {% endfor -%}
                        </ul>
                    </dd>
                </div>
            </dl>
        </div>
    </section>

    <section class="app-summary-card govuk-!-margin-bottom-6 app-summary-card--large-title" id ="case-details">
        <header class="app-summary-card__header">
            <h2 class="app-summary-card__title">Case details</h2>
        </header>
        <div class="app-summary-card__body">
            {{ govukSummaryList({
                rows: [
                    {
                        key: {
                        text: "PNC"
                    },
                        value: {
                        text: data.pncNumber
                    }
                    },
                    {
                        key: {
                        text: "CPS pack"
                    },
                        value: {
                        html: (data.cpsPack.completedDate | dateFormat + '<br><a class="govuk-link--no-visited-state" href="/' + crn + '/convictions/' + convictionId + '/documents/' + data.cpsPack.documentId + '">Download pack</a>' if data.cpsPack.completedDate else '<strong class="govuk-tag govuk-tag--grey">No pack created</strong>' )
                    }
                    },
                    {
                        key: {
                        text: "Pre-convictions"
                    },
                        value: {
                        html: (data.preConvictionDocument.completedDate | dateFormat + '<br><a class="govuk-link--no-visited-state" href="/' + crn + '/convictions/' + convictionId + '/documents/' + data.preConvictionDocument.documentId + '">Download document</a>' if data.preConvictionDocument.completedDate else '<strong class="govuk-tag govuk-tag--grey">No document created</strong>' )
                    }
                    },
                    {
                        key: {
                        html: 'Pre-sentence report' + ('<br><span class="govuk-!-font-size-16 govuk-!-font-weight-regular">' + data.courtReport.description + '</span>' if data.courtReport.description)
                    },
                        value: {
                        html: (data.courtReport.completedDate | dateFormat + '<br><a class="govuk-link--no-visited-state" href="/' + crn + '/convictions/' + convictionId + '/documents/' + data.courtReport.documentId + '">Download report</a>' if data.courtReport.completedDate else '<strong class="govuk-tag govuk-tag--grey">No report created</strong>' )
                    }
                    },
                    {
                        key: {
                        html: 'Last OASys assessment' + ('<br><span class="govuk-!-font-size-16 govuk-!-font-weight-regular">OASys Assessment ' + data.assessment.type | capitalize | replace("_", " ")  + '</span>' if data.assessment.type)
                    },
                        value: {
                        text: (data.assessment.lastAssessedOn | dateFormat if data.assessment.lastAssessedOn else '<strong class="govuk-tag govuk-tag--grey">No assessment created</strong>' | safe )
                    }
                    }
                ]
            })}}
        </div>
    </section>

    {{ instructions({convictionId: convictionId }) }}


{% endblock %}


